<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Crear evaluación</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Crear evaluación</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-grid>

    <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">

      <mat-card class="example-card form">
        <mat-card-header>
          <ion-row class="ion-justify-content-between max-width">
            <ion-col>
              <mat-card-title>Detalles de la evaluación</mat-card-title>
            </ion-col>
            <ion-row class="ion-padding">
              <button class="margin-vertical" mat-raised-button color="primary">Guardar</button>
            </ion-row>
          </ion-row>
        </mat-card-header>
        <mat-card-content>

          <div>
            <mat-form-field color="primary" [style.width.%]="100" appearance="outline">
              <mat-label>Nombre de la prueba</mat-label>
              <input matInput placeholder="Nombre de la prueba" formControlName="Titulo">
              <div *ngIf="submitted && f.Titulo.errors">
                <mat-error *ngIf="f.Titulo.errors.required">Este campo es obligatorio</mat-error>
              </div>
            </mat-form-field>
          </div>

          <div>
            <mat-form-field color="primary" [style.width.%]="100" appearance="outline">
              <mat-label>Descripción de la prueba</mat-label>
              <textarea matInput placeholder="Descripción de la prueba" formControlName="Descripcion"></textarea>
              <div *ngIf="submitted && f.Descripcion.errors">
                <mat-error *ngIf="f.Descripcion.errors.required">Este campo es obligatorio</mat-error>
              </div>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" [style.width.%]="100">
            <mat-label>Competencia</mat-label>
            <mat-select formControlName="Competencia_ID">
              <mat-option *ngFor="let compentencia of competencias" [value]="compentencia.Id">
                {{compentencia.Value}}
              </mat-option>
            </mat-select>
            <div *ngIf="submitted && f.Competencia_ID.errors">
              <mat-error *ngIf="f.Competencia_ID.errors.required">Este campo es obligatorio</mat-error>
            </div>
          </mat-form-field>

          <mat-form-field appearance="outline" [style.width.%]="100">
            <mat-label>Sección</mat-label>
            <mat-select formControlName="seccion_ID">
              <mat-option *ngFor="let section of sections" [value]="section.ID_Seccion">
                {{section.Nombre}}
              </mat-option>
            </mat-select>
            <div *ngIf="submitted && f.seccion_ID.errors">
              <mat-error *ngIf="f.seccion_ID.errors.required">Este campo es obligatorio</mat-error>
            </div>
          </mat-form-field>

          <ion-row>

            <ion-col>
              <label class="time-label-padding">Objetivos : </label>
              <p-multiSelect formControlName="objetivos_id" [options]="objetives" placeholder="Objetivos" optionLabel="Value" optionValue="Id">
                <ng-template let-option pTemplate="item">
                  <div class="p-multiselect-representative-option">
                    <span class="p-ml-1">{{option.Value}}</span>
                  </div>
                </ng-template>
              </p-multiSelect>
            </ion-col>

            <ion-col>
              <label class="time-label-padding">Fecha de inicio : </label>
              <p-calendar (ngModelChange)="onStartDateChange($event)" formControlName="FechaInicio" styleClass="p-calendar-class" [showTime]="true"
                          inputId="time" #startDate
              ></p-calendar>
            </ion-col>
            <ion-col>
              <label class="time-label-padding">Fecha de fin : </label>
              <p-calendar formControlName="FechaFin" styleClass="p-calendar-class" [showTime]="true"
                          inputId="time"
                          [minDate]="getDateWithFourHour( startDate.value )"
              ></p-calendar>
            </ion-col>
          </ion-row>

          <mat-card class="example-card form">
            <mat-card-header>
              <ion-row class="ion-justify-content-between max-width">
                <ion-col>
                  <mat-card-title>Preguntas</mat-card-title>
                </ion-col>
                <ion-row>
                  <ion-button (click)="addNewQuestion()">
                    <ion-icon slot="start" name="add-outline"></ion-icon>
                    <mat-label>Agregar nueva pregunta</mat-label>
                  </ion-button>

                </ion-row>
              </ion-row>
            </mat-card-header>
            <mat-card-content>

              <div formArrayName="questions">
                <div *ngFor="let question of questions.controls; let i=index">
                  <div [formGroupName]="i">

                    <div [formGroup]="question">
                      <mat-form-field appearance="outline" [style.width.%]="100">
                        <mat-label>Pregunta número: {{i + 1}}</mat-label>
                        <input matInput
                               formControlName="question"
                               placeholder="Pregunta número: {{i + 1}}">
                      </mat-form-field>

                      <ion-row>

                        <ion-button (click)="addAnswerForQuestion( i )">
                          <ion-icon slot="start" name="add-outline"></ion-icon>
                          <mat-label>Agregar respuesta</mat-label>
                        </ion-button>

                        <button mat-icon-button color="warn" (click)="removeQuestion( i )">
                          <mat-icon>delete</mat-icon>
                        </button>

                      </ion-row>

                      <div formArrayName="answers">
                        <ion-row>
                          <div *ngFor="let answer of getAnswersForQuestion( question ); let index=index">
                            <div [formGroupName]="index">
                              <div [formGroup]="answer">

                                <ion-col>
                                  <div class="answer-card">
                                    <div [style.width.%]="70">
                                      <input #file type="file" hidden #fileUpload accept="image/*"
                                             (click)="fileUpload.value = null"
                                             (change)="convertFileToBase64($event.target.files, answer)">
                                      <input type="text" formControllName="img" hidden>
                                      <ion-row class="ion-justify-content-center">
                                        <img class="answer-img" [src]="answer.controls.img.value">
                                      </ion-row>
                                      <ion-row class="ion-justify-content-center">
                                        <ion-button (click)="fileUpload.click()">
                                          <ion-icon slot="start" name="camera-outline"></ion-icon>
                                          <mat-label> Seleccione una imagen</mat-label>
                                        </ion-button>
                                      </ion-row>
                                    </div>

                                    <mat-form-field appearance="outline" [style.width.%]="70">
                                      <mat-label>Respuesta número: {{i + 1}}</mat-label>
                                      <input matInput
                                             formControlName="description"
                                             placeholder="Respuesta número: {{i + 1}}">
                                    </mat-form-field>

                                    <mat-checkbox formControlName="isCorrectAnswer" class="example-margin">Es una
                                      respuesta correcta ?
                                    </mat-checkbox>

                                    <button mat-icon-button color="warn" (click)="removeAnswerForQuestion(i, index)">
                                      <mat-icon>delete</mat-icon>
                                    </button>

                                  </div>
                                </ion-col>

                              </div>
                            </div>
                          </div>

                        </ion-row>
                      </div>

                    </div>

                  </div>

                  <br>
                  <mat-divider class="divider-padding"></mat-divider>
                  <br>

                </div>

              </div>

            </mat-card-content>
          </mat-card>

          <!-- <p>
            <button type="submit">Guardar</button>
          </p> -->


        </mat-card-content>
      </mat-card>

    </form>

  </ion-grid>
</ion-content>
